#!/bin/bash

# ─ Copyright Notice ───────────────────────────────────────────────────
#
# Copyright 2000-2023 Hans Deragon - GPL 3.0 licence.
#
# Hans Deragon (hans@deragon.biz) owns the copyright of this work.
#
# It is released under the GPL 3 licence which can be found at:
#
#     https://www.gnu.org/licenses/gpl-3.0.en.html
#
# ─────────────────────────────────────────────────── Copyright Notice ─

SCRIPT_NAME="${0/*\/}"

usage()
{
  cat <<EOM
Usage:  ${SCRIPT_NAME} <file>

Removes all references of date and time to file passed as a parameter
and send output to '<file>.diffready'.

EOM
}

SORT=0
while getopts "szh" OPTCMD; do
  case "${OPTCMD}" in
    "n")    NAME="${OPTARG}";;
    "s")    SORT=1;;
    "h"|*)  usage; exit 1;;
  esac
done

shift $((${OPTIND} - 1))  # Remove options from $@
FILE="${1}"
NEWFILE="${1}.diffready"

OUTPUT=`perl -pe "s%(\W*)\d{2,4}[-/]*\d{2}[-/]*\d{2,4}(\W+)%\1<date removed>\2%g;  s%(\W+)\d{2}:*\d{2}:*\d{2}(?:[,| ]\d+)*(\W+)%\1<time removed>\2%g" "${FILE}"`

if (( "${SORT}" )) ; then
  echo -e "${OUTPUT}" | sort >"${NEWFILE}"
else
  echo -e "${OUTPUT}" >"${NEWFILE}"
fi
